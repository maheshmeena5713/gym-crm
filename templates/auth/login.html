{% extends "base.html" %}
{% load static %}
{% block title %}Login{% endblock %}

{% block auth_content %}
<div class="w-full max-w-md px-6">
    <!-- Logo -->
    <div class="text-center mb-8">
        <a href="/" class="inline-flex items-center gap-2 text-slate-400 hover:text-white transition-colors text-sm mb-4">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            Back to Home
        </a>
        <img src="{% static 'images/gymedgelogo.png' %}" alt="GymEdge Logo" class="h-20 mx-auto mb-4 object-contain filter drop-shadow-[0_0_12px_rgba(239,68,68,0.4)]">
        <h1 class="text-2xl font-bold text-white">Welcome to GymEdge</h1>
        <p class="text-slate-400 mt-1 text-sm">AI-powered gym management</p>
    </div>

    <!-- Login Card -->
    <div class="bg-slate-900 border border-slate-800 rounded-2xl p-6 shadow-xl">
        <div id="auth-form">
            {% if entity_name %}
                {% include "auth/phone_form.html" %}
            {% else %}
                {% include "auth/gym_code_form.html" %}
            {% endif %}
        </div>
    </div>

    <!-- Footer -->
    <div class="mt-6 text-center">
        <div class="text-sm text-slate-400">
            Don't have an account? <a href="{% url 'frontend:signup' %}" class="font-medium text-brand-400 hover:text-brand-300 transition-colors">Sign up</a>
        </div>
    </div>
</div>

<script>
    // localStorage gym code caching â†’ auto-skip to phone form
    document.addEventListener('DOMContentLoaded', function() {
        // First try reading from the cookie set during login
        try {
            const cookieData = document.cookie.split(';').map(c => c.trim()).find(c => c.startsWith('gym_cache_data='));
            if (cookieData) {
                const gymInfo = JSON.parse(decodeURIComponent(cookieData.split('=').slice(1).join('=')));
                if (gymInfo && gymInfo.gym_code) {
                    localStorage.setItem('gymai_gym_cache', JSON.stringify(gymInfo));
                    // Clear the cookie after reading
                    document.cookie = 'gym_cache_data=; Max-Age=0; path=/';
                }
            }
        } catch(e) {}

        // Check localStorage for cached gym code
        try {
            const cached = JSON.parse(localStorage.getItem('gymai_gym_cache'));
            if (cached && cached.gym_code) {
                // Auto-submit the gym code to skip to phone form
                const gymCodeInput = document.getElementById('gym_code');
                if (gymCodeInput) {
                    gymCodeInput.value = cached.gym_code;
                    // Trigger HTMX form submit after a short delay so HTMX is initialized
                    setTimeout(function() {
                        const form = gymCodeInput.closest('form');
                        if (form && window.htmx) {
                            htmx.trigger(form, 'submit');
                        }
                    }, 200);
                }
            }
        } catch(e) {}
    });
</script>
{% endblock %}
